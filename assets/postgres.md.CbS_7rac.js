import{_ as s,o as a,c as t,ae as i}from"./chunks/framework.CfVLvsAT.js";const k=JSON.parse('{"title":"Chapter 20: Postgres (The Safe)","description":"","frontmatter":{},"headers":[],"relativePath":"postgres.md","filePath":"postgres.md"}'),n={name:"postgres.md"};function o(l,e,r,h,p,d){return a(),t("div",null,[...e[0]||(e[0]=[i(`<h1 id="chapter-20-postgres-the-safe" tabindex="-1">Chapter 20: Postgres (The Safe) <a class="header-anchor" href="#chapter-20-postgres-the-safe" aria-label="Permalink to &quot;Chapter 20: Postgres (The Safe)&quot;">â€‹</a></h1><h2 id="_20-1-the-low-level-driver" tabindex="-1">20.1 The Low-Level Driver <a class="header-anchor" href="#_20-1-the-low-level-driver" aria-label="Permalink to &quot;20.1 The Low-Level Driver&quot;">â€‹</a></h2><p>To talk to a SQL database, Go uses the standard package <code>database/sql</code>. However, <code>database/sql</code> is just a <strong>Manager</strong>. It needs a worker (Driver) to speak the specific language of PostgreSQL.</p><p>We import the driver <strong>Blankly</strong>:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/lib/pq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><h3 id="anatomy-of-the-blank-import" tabindex="-1">Anatomy of the Blank Import (<code>_</code>) <a class="header-anchor" href="#anatomy-of-the-blank-import" aria-label="Permalink to &quot;Anatomy of the Blank Import (\`_\`)&quot;">â€‹</a></h3><ol><li><strong><code>import</code></strong>: Bring in code.</li><li><strong><code>_</code> (Underscore)</strong>: &quot;I am not going to call this package directly in my code.&quot; <ul><li><em>Why?</em> We only want the package&#39;s <code>init()</code> function to run.</li><li>Inside <code>lib/pq</code>, the <code>init()</code> function registers itself with Go&#39;s SQL Manager: &quot;Hey, I know how to talk to Postgres!&quot;</li></ul></li></ol><h3 id="the-enemy-sql-injection" tabindex="-1">The Enemy: SQL Injection <a class="header-anchor" href="#the-enemy-sql-injection" aria-label="Permalink to &quot;The Enemy: SQL Injection&quot;">â€‹</a></h3><p>If you concatenate strings (<code>&quot;SELECT * FROM users WHERE name = &quot; + input</code>), you create a <strong>Hole in the Wall</strong>. A hacker can pass <code>&#39;; DROP TABLE users; --</code> and destroy your database.</p><p><strong>The Solution: Armored Windows ($1)</strong> When you use placeholders (<code>$1</code>, <code>$2</code>), you send the data in a separate, sealed envelope. The database treats it strictly as <em>text</em>, never as <em>commands</em>.</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// BAD (Hole in the Wall)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM users WHERE id = &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GOOD (Armored Window)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM users WHERE id = $1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id)</span></span></code></pre></div><h3 id="_20-2-connect-ping" tabindex="-1">20.2 Connect &amp; Ping <a class="header-anchor" href="#_20-2-connect-ping" aria-label="Permalink to &quot;20.2 Connect &amp; Ping&quot;">â€‹</a></h3><p>on Pooling (<code>sql.Open</code>)</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sql.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;postgres&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user=dake dbname=shop...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Crucial Concept</strong>: <code>sql.Open</code> does NOT establish a connection. It prepares a <strong>Connection Pool</strong>.</p><ul><li>It opens connections only when needed.</li><li>It keeps them open for reuse (Performance).</li><li>It handles network drops automatically.</li></ul><p>Comparison:</p><ul><li><strong>Python/Django</strong>: Often opens a new connection per request (Slow).</li><li><strong>Go</strong>: Maintains a pool of long-lived connections (Fast).</li></ul><details class="details custom-block"><summary>ðŸŽ“ Knowledge Check: Does <code>sql.Open</code> connect to the database immediately?</summary><p><strong>Answer</strong>: <strong>No!</strong> It only initializes the <strong>Connection Pool</strong> and config. The actual connection happens lazily when you first try to query the DB (e.g., <code>db.Ping()</code>).</p></details>`,19)])])}const g=s(n,[["render",o]]);export{k as __pageData,g as default};

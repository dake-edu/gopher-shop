import{_ as s,o as a,c as n,ae as e}from"./chunks/framework.CfVLvsAT.js";const g=JSON.parse('{"title":"14. The Onion (Middleware)","description":"","frontmatter":{},"headers":[],"relativePath":"middleware.md","filePath":"middleware.md"}'),t={name:"middleware.md"};function l(h,i,r,p,o,k){return a(),n("div",null,[...i[0]||(i[0]=[e(`<h1 id="_14-the-onion-middleware" tabindex="-1">14. The Onion (Middleware) <a class="header-anchor" href="#_14-the-onion-middleware" aria-label="Permalink to &quot;14. The Onion (Middleware)&quot;">​</a></h1><p>This is one of the most advanced concepts in Go web servers. Let&#39;s dissect it carefully.</p><h2 id="_14-1-functions-as-values" tabindex="-1">14.1 Functions as Values <a class="header-anchor" href="#_14-1-functions-as-values" aria-label="Permalink to &quot;14.1 Functions as Values&quot;">​</a></h2><p>In Go, a function is a value. You can:</p><ol><li>Store it in a variable.</li><li>Pass it as an argument.</li><li>Return it from another function.</li></ol><h2 id="_14-2-the-middleware-signature" tabindex="-1">14.2 The Middleware Signature <a class="header-anchor" href="#_14-2-the-middleware-signature" aria-label="Permalink to &quot;14.2 The Middleware Signature&quot;">​</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Logging</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HandlerFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResponseWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Pre-Processing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        next.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ServeHTTP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, r) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Pass the baton</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Post-Processing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;End&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="line-by-line-anatomy" tabindex="-1">Line-by-Line Anatomy <a class="header-anchor" href="#line-by-line-anatomy" aria-label="Permalink to &quot;Line-by-Line Anatomy&quot;">​</a></h3><ol><li><strong><code>func Logging(next http.Handler) http.Handler</code></strong>: <ul><li>Input: The <strong>Next</strong> layer of the onion (the inner handler).</li><li>Output: A <strong>New</strong> handler that wraps the old one.</li></ul></li><li><strong><code>return http.HandlerFunc(...)</code></strong>: <ul><li>We are building a new handler on the fly.</li></ul></li><li><strong><code>func(w, r)</code></strong>: <ul><li>This is the <strong>Closure</strong>. It captures the <code>next</code> variable from outside.</li></ul></li><li><strong><code>next.ServeHTTP(w, r)</code></strong>: <ul><li><strong>Crucial</strong>: This calls the original handler.</li><li>If you forget this line, the request stops here. The User never gets a response.</li></ul></li></ol><h2 id="_14-3-visualizing-the-chain" tabindex="-1">14.3 Visualizing the Chain <a class="header-anchor" href="#_14-3-visualizing-the-chain" aria-label="Permalink to &quot;14.3 Visualizing the Chain&quot;">​</a></h2><p>When we wrap handlers: <code>Logging(Auth(HomeHandler))</code></p><ol><li>Request arrives $\\rightarrow$ <strong>Logging</strong> starts.</li><li>Logging calls <code>next</code> $\\rightarrow$ <strong>Auth</strong> starts.</li><li>Auth calls <code>next</code> $\\rightarrow$ <strong>HomeHandler</strong> (Business Logic).</li><li>HomeHandler returns.</li><li><strong>Auth</strong> finishes.</li><li><strong>Logging</strong> finishes.</li></ol>`,12)])])}const E=s(t,[["render",l]]);export{g as __pageData,E as default};
